<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <title>Äáº·t lá»‹ch thÃ nh cÃ´ng</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- CSS -->
    <link rel="stylesheet" href="css/style.css">

    <!-- ThÆ° viá»‡n táº¡o PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>

<body>
    <!-- HEADER LOGO -->
    <header class="header-logo">
        <a href="trangchu.html" class="logo-link">
            <img src="images/logo.png" alt="Logo phÃ²ng khÃ¡m" class="logo">
            <span class="company-name">PhÃ²ng khÃ¡m BÃ¡c sÄ© bÃªn con</span>
        </a>
    </header>
    <div class="result-card">

        <!-- PHIáº¾U (PHáº¦N CHá»¤P PDF) -->
        <div id="ticket" class="success">
            <h1>âœ… Äáº·t lá»‹ch khÃ¡m thÃ nh cÃ´ng</h1>

            <div class="summary">
                <p><strong>ğŸ« MÃ£ lá»‹ch háº¹n:</strong> <span id="maHen"></span></p>
                <p><strong>ğŸ‘¶ Tráº»:</strong> <span id="childName"></span></p>
                <p><strong>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ Phá»¥ huynh:</strong> <span id="parentName"></span></p>
                <p><strong>ğŸ“ Sá»‘ Ä‘iá»‡n thoáº¡i:</strong> <span id="phone"></span></p>
                <p><strong>ğŸ§‘â€âš•ï¸ BÃ¡c sÄ©:</strong> <span id="doctor"></span></p>
                <p><strong>ğŸ“… NgÃ y khÃ¡m:</strong> <span id="date"></span></p>
                <p><strong>ğŸ•’ Giá» khÃ¡m:</strong> <span id="time"></span></p>
                <p><strong>ğŸ©º Buá»•i:</strong> <span id="session"></span></p>
                <p id="reasonRow">
                    <strong>ğŸ“ LÃ½ do khÃ¡m:</strong>
                    <span id="reason"></span>
                </p>
            </div>

            <p class="note">
                ğŸ“Œ QuÃ½ phá»¥ huynh vui lÃ²ng lÆ°u láº¡i thÃ´ng tin phiáº¿u khÃ¡m vÃ  ghi nhá»› mÃ£ lá»‹ch háº¹n
            </p>
            <p class="note">
                ğŸ“Œ QuÃ½ phá»¥ huynh vui lÃ²ng Ä‘Æ°a tráº» Ä‘áº¿n phÃ²ng khÃ¡m
                <strong>trÆ°á»›c giá» háº¹n 10 phÃºt</strong>. <br>
                Náº¿u khÃ´ng thá»ƒ Ä‘áº¿n theo lá»‹ch háº¹n, anh/chá»‹ vui lÃ²ng há»§y sá»›m Ä‘á»ƒ phÃ²ng khÃ¡m phá»¥c vá»¥ bÃ© khÃ¡c â¤ï¸ <br>
                Náº¿u quÃ¡ giá» háº¹n 10 phÃºt mÃ  tráº» chÆ°a Ä‘áº¿n khÃ¡m, phiáº¿u Ä‘áº·t lá»‹ch sáº½ khÃ´ng cÃ²n giÃ¡ trá»‹.
            </p>
        </div>


    </div>

    <!-- NÃšT HÃ€NH Äá»˜NG (KHÃ”NG CHá»¤P PDF) -->
    <div class="action-buttons-wrapper">
        <div class="action-buttons">
            <a id="zaloShareBtn" class="btn btn-primary" target="_blank">
                <img src="images/zalo-icon.webp" alt="Zalo" class="zalo-icon">
                Gá»­i lá»‹ch háº¹n qua Zalo
            </a>
            <button onclick="savePDF()" class="btn btn-primary">
                ğŸ“„ LÆ°u phiáº¿u Ä‘Äƒng kÃ½ (PDF)
            </button>
            <button onclick="saveImage()" class="btn btn-primary">
                ğŸ“¸ LÆ°u áº£nh phiáº¿u khÃ¡m
            </button>

            <a href="index.html" class="btn btn-secondary">
                ğŸ”„ Äáº·t lá»‹ch má»›i
            </a>
            <p style="margin-top:15px;">
                ğŸ‘‰ <a href="tracuu.html">Nháº¥n vÃ o Ä‘Ã¢y Ä‘á»ƒ há»§y lá»‹ch khÃ¡m</a>
            </p>
        </div>
    </div>


    </div>
    <div id="capture-wrapper" class="capture-hidden">
        <div class="capture-header">
            <img src="images/logo.png" class="capture-logo">
            <div class="capture-title">
                <div class="clinic-name">PhÃ²ng khÃ¡m BÃ¡c sÄ© bÃªn con</div>
                <div class="clinic-sub">Phiáº¿u xÃ¡c nháº­n lá»‹ch khÃ¡m</div>
            </div>
        </div>

        <div id="ticketCapture"></div>
        <p class="note">
            ğŸ•“ <strong>Thá»i Ä‘iá»ƒm Ä‘áº·t lá»‹ch:</strong>
            <span id="createdAt"></span>
        </p>
        <div class="capture-footer">
            ğŸ“ Äá»‹a chá»‰: 88 Thanh NhÃ n | â˜ 0985403030
        </div>
    </div>


    <!-- JS -->
    <script src="js/success.js"></script>

    <!-- HÃ€M Táº O PDF -->
    <script>
        async function savePDF() {
            const { jsPDF } = window.jspdf;
            const wrapper = document.getElementById("capture-wrapper");

            wrapper.style.display = "block";      // â­ THÃŠM
            wrapper.classList.add("pdf-mode");

            document.getElementById("ticketCapture").innerHTML =
                document.getElementById("ticket").innerHTML;

            await new Promise(r => setTimeout(r, 50));

            const canvas = await html2canvas(wrapper, {
                scale: 2,
                useCORS: true,
                backgroundColor: "#ffffff"
            });

            const imgData = canvas.toDataURL("image/png");

            const pdf = new jsPDF({
                orientation: "portrait",
                unit: "mm",
                format: "a4"
            });

            const pageWidth = pdf.internal.pageSize.getWidth();
            const imgWidth = pageWidth - 20;
            const imgHeight = (canvas.height * imgWidth) / canvas.width;

            pdf.addImage(imgData, "PNG", 10, 10, imgWidth, imgHeight);
            pdf.save("phieu-kham.pdf");

            wrapper.classList.remove("pdf-mode");
            wrapper.style.display = "none";
        }


    </script>




    <!-- HÃ€M chá»¥p áº£nh -->
    <script>
        async function saveImage() {
            const wrapper = document.getElementById("capture-wrapper");

            wrapper.style.display = "block";
            wrapper.classList.remove("pdf-mode");

            document.getElementById("ticketCapture").innerHTML =
                document.getElementById("ticket").innerHTML;

            const canvas = await html2canvas(wrapper, {
                scale: 2,
                backgroundColor: "#ffffff"
            });

            const link = document.createElement("a");
            link.href = canvas.toDataURL("image/png");
            link.download = "phieu-kham.png";
            link.click();

            wrapper.style.display = "none";
        }

    </script>

    </div>

</body>

</html>